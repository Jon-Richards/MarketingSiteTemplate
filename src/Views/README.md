# Views Library

A unified Razor class library combining server-side Razor components with client-side React/TypeScript and Tailwind CSS styling.

## Project Structure

```
MarketingSiteTemplate/                 # Project root
├── src/
│   ├── Views/                          # Razor class library (this project)
│   │   ├── Server/
│   │   │   ├── Components/             # Razor components (Card, Alert, etc.)
│   │   │   └── Pages/                  # Razor pages
│   │   ├── Client/                     # React/TypeScript components
│   │   │   ├── components/             # Reusable React components
│   │   │   ├── pages/                  # Page components
│   │   │   ├── features/               # Feature modules
│   │   │   ├── styles/                 # CSS files (Tailwind directives)
│   │   │   ├── App.tsx                 # Root React component
│   │   │   └── main.tsx                # React entry point
│   │   ├── wwwroot/
│   │   │   ├── bundle/                 # Vite output (generated, don't commit)
│   │   │   │   ├── index.css           # Compiled Tailwind
│   │   │   │   ├── app.js              # Bundled React/TypeScript
│   │   │   │   └── index.html
│   │   │   └── static/                 # Static assets (images, fonts, etc.)
│   │   ├── Views.csproj                # Razor class library project
│   │   └── index.html                  # Vite entry point
│   ├── Site/                           # ASP.NET Core host application
│   │   ├── Pages/                      # Razor pages (Index, Privacy, etc.)
│   │   ├── wwwroot/                    # Static files (Site's own assets)
│   │   └── Site.csproj
│   └── CMS/                            # (Additional project)
├── vite.config.ts                      # Vite build configuration (project root)
├── tailwind.config.js                  # Tailwind CSS configuration
├── tsconfig.json                       # TypeScript configuration
├── package.json                        # npm scripts and dependencies
├── index.html                          # ⚠️ DEPRECATED - use src/Views/index.html instead
└── [other config files]
```

**Key Points:**
- Configuration files (`vite.config.ts`, `tailwind.config.js`, `tsconfig.json`, `package.json`) live at the **project root** for easier multi-project use
- Vite's entry point is at `src/Views/index.html`
- `wwwroot/bundle/` is generated by Vite—never commit it
- `wwwroot/static/` is for hand-crafted static assets

## Architecture

### Single Unified Project
- **Views.csproj**: Razor class library targeting net9.0
- **One build pipeline**: Both Server and Client assets built together
- **Shared styling**: Tailwind CSS scans both Razor and React templates

### Build Output
- **wwwroot/bundle/**: Generated by Vite (Razor expects wwwroot/)
  - Never commit to git - regenerated on each build
- **wwwroot/static/**: Hand-crafted static assets
  - Committed to git
  - Images, fonts, and other libraries that rarely change

### Development Workflow

#### Prerequisites
```bash
# From project root.
npm install
```

#### Local Development (Recommended)

**For active development with hot reload on both client and server:**

```bash
# Terminal 1 (in project root): Watch Client files and rebuild bundle on changes
npm run watch

# Terminal 2 (in project root): Watch .NET files and Razor components
dotnet watch --project ./src/Site
```

This setup gives you:
- Instant feedback on React/TypeScript changes
- Automatic page refresh when Razor or .NET code changes
- Both npm and dotnet rebuilds triggered by file changes

**Alternative: Full dev server with hot module reloading**

```bash
# Terminal 1: Run Vite dev server (HMR on client-side)
npm run dev

# Terminal 2: Run ASP.NET Core
dotnet run --project src/Site
```

This gives faster client-side feedback but requires manual Razor recompilation.

#### Building
```bash
# Build for production
npm run build

# This generates wwwroot/bundle/ with minified assets
```

## Configuration Files

### Views.csproj
Razor class library project file. Targets net9.0 with Razor SDK.

### vite.config.ts
Configures Vite to:
- Build React/TypeScript from `Client/` folder
- Output to `wwwroot/bundle/`
- Set up TypeScript path aliases for clean imports

### tailwind.config.js
Scans:
- `Server/**/*.razor` - Razor components
- `Client/**/*.{ts,tsx}` - React/TypeScript components

Generates CSS that works for both server and client rendering.

### package.json
Contains npm scripts and dev dependencies:
- **npm run dev**: Start Vite dev server with HMR (hot module reloading)
- **npm run build**: Production build to `src/Views/wwwroot/bundle/`
- **npm run watch**: Watch Client files and rebuild bundle on changes (recommended for `dotnet watch`)

### TypeScript Configuration
- `tsconfig.json`: Main TypeScript config with path aliases
- `tsconfig.node.json`: Config for Vite and build tools

### Code Quality
- `.eslintrc.js`: ESLint configuration for TypeScript/React
- `.prettierrc.json`: Code formatting rules
- `stylelint.config.js`: CSS/Tailwind linting

## Asset References & Static Web Assets

### How Assets Are Served

This Views library is a **Razor Class Library (RCL)** and leverages ASP.NET Core's static web assets convention:
- All files in `wwwroot/` are served at `~/_content/Views/` when the library is referenced by a host application
- Tailwind CSS bundle: `/_content/Views/bundle/index.css`
- Static images: `/_content/Views/static/images/`

### In Razor Templates

Use the ASP.NET Core path expansion operator `~/`:

```razor
<!-- From _Layout.cshtml or any Razor template -->
<link rel="stylesheet" href="~/_content/Views/bundle/index.css" />
<img src="~/_content/Views/static/images/logo.png" />
```

### In React Components

React runs client-side, so it cannot use `~/` expansion. Use absolute paths with the RCL content path:

```tsx
// ✅ Assets bundled by Vite (preferred)
import logo from '../images/logo.png';
export function MyComponent() {
  return <img src={logo} />;
}

// ✅ Static assets served separately (if needed)
export function MyComponent() {
  return <img src="/_content/Views/static/images/logo.png" />;
}

// ❌ Wrong - relative paths won't work from the bundle
return <img src="images/logo.png" />;
```

### Best Practices

1. **Bundle assets with Vite**: If an image/font is used only in React components, import it directly. Vite handles the path resolution.
2. **Use static/ for shared assets**: Images needed by both Razor and React components should go in `wwwroot/static/` and referenced via the RCL content path.
3. **Never hardcode relative paths**: React components can't resolve relative paths reliably—always use absolute `/_content/Views/` paths for static assets.

## Getting Started

### 1. Install Dependencies
```bash
# From project root
npm install
```

### 2. Start Development

Use the recommended workflow from the [Development Workflow](#development-workflow) section above:

```bash
# Terminal 1 (in project root): Watch Client files and rebuild bundle
npm run watch

# Terminal 2 (in project root): Watch .NET files and Razor components
dotnet watch --project ./src/Site
```

Navigate to `http://localhost:5000` (or the port shown in the output).

### 3. Create Components

#### Server-side Razor Component
Create `src/Views/Server/Components/MyComponent.razor`:
```razor
<div class="p-4 bg-blue-100">
    <h1 class="text-lg font-bold">Hello from Razor</h1>
</div>

@code {
    // Component logic
}
```

#### Client-side React Component
Create `src/Views/Client/components/MyButton.tsx`:
```typescript
import React from 'react';

export function MyButton() {
  return (
    <button className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
      Click me
    </button>
  );
}
```

## Styling with Tailwind

Both Razor and React components can use Tailwind CSS classes:

```razor
<!-- In Razor -->
<div class="flex items-center justify-center h-screen bg-gradient-to-r from-blue-500 to-purple-600">
</div>
```

```typescript
// In React
<div className="flex items-center justify-center h-screen bg-gradient-to-r from-blue-500 to-purple-600">
</div>
```

## Build & Deployment

### Local Build
```bash
# From project root: Build for production
npm run build

# Or let dotnet handle it automatically
dotnet build
```

The `npm run build` generates `src/Views/wwwroot/bundle/` with minified JavaScript and CSS.

**Note:** `dotnet build` automatically runs `npm run build` as part of the Views.csproj build target, so you typically only need to run `dotnet build`.

### Deployment
When publishing with `dotnet publish`:
1. `npm run build` is triggered automatically by Views.csproj
2. All assets in `wwwroot/` (both `bundle/` and `static/`) are packaged as static web assets
3. Host application serves them from the `~/_content/Views/` path

### Environment Variables
Create `.env.local` in the Views folder for dev-only settings:
```
VITE_API_URL=http://localhost:5000
```

Access in React:
```typescript
const apiUrl = import.meta.env.VITE_API_URL;
```

## Git Workflow

### Commit These
- All source code (`Server/`, `Client/`)
- Configuration files (`vite.config.ts`, `tailwind.config.js`, etc.)
- Static assets (`wwwroot/static/`)
- `package.json` and `package-lock.json`

### Don't Commit These
- `node_modules/` - regenerated on `npm install`
- `wwwroot/bundle/` - regenerated on `npm run build`
- `.env.local` - local environment only

See [.gitignore](.gitignore) for full list.

## TypeScript Path Aliases

Use these shortcuts for cleaner imports:

```typescript
// Instead of:
import Button from '../../../components/Button';

// Use:
import Button from '@components/Button';
```

Available aliases:
- `@components/` → `./Client/components/`
- `@pages/` → `./Client/pages/`
- `@features/` → `./Client/features/`
- `@styles/` → `./Client/styles/`

## Troubleshooting

### Port 5173 already in use
Vite automatically uses the next available port (5174, 5175, etc.).

### Tailwind styles not showing
- Ensure `npm run build` was run
- Check `tailwind.config.js` includes your template paths
- Verify CSS is imported in `Client/main.tsx`

### TypeScript errors on import
- Verify path aliases in `tsconfig.json`
- Check file extensions (.tsx, .ts)
- Ensure `tsconfig.json` is in the Views root

## Learn More

- [Vite Documentation](https://vitejs.dev/)
- [React Documentation](https://react.dev/)
- [Tailwind CSS Documentation](https://tailwindcss.com/)
- [Razor Components](https://learn.microsoft.com/en-us/aspnet/core/razor-components/)
